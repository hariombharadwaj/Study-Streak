<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Streak Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            transition: background 0.3s ease;
        }
        body.light {
            background: linear-gradient(to bottom, #e0e7ff, #f3f4f6);
        }
        body.dark {
            background: linear-gradient(to bottom, #1e293b, #0f172a);
        }
        .gif-badge-container {
            width: 100%;
            max-width: 600px;
            height: 320px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .gif-badge-container:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 32px rgba(0,0,0,0.25);
        }
        .gif-badge-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .small-gif {
            width: 160px;
            height: 100px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .small-gif:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .small-gif:active {
            transform: scale(0.95);
        }
        .small-gif img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .progress-bar-visual {
            height: 28px;
            background: #d1d5db;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
            display: flex;
        }
        .dark .progress-bar-visual {
            background: #374151;
        }
        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .badge-item {
            background: white;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        .dark .badge-item {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .badge-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .badge-item.current {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.8); }
        }
        .badge-item.unlocked {
            background: white;
        }
        .dark .badge-item.unlocked {
            background: #1e293b;
        }
        .badge-item.locked {
            background: #f9fafb;
            opacity: 0.6;
        }
        .dark .badge-item.locked {
            background: #0f172a;
        }
        .tap-to-play {
            background: #d1d5db;
            color: #6b7280;
            padding: 32px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .dark .tap-to-play {
            background: #374151;
            color: #9ca3af;
        }
        .tap-to-play:active {
            transform: scale(0.98);
        }
        .compact-timer {
            font-size: 12px;
            color: #6b7280;
            padding: 8px 16px;
            background: white;
            border-radius: 8px;
            display: inline-block;
            transition: all 0.3s;
        }
        .dark .compact-timer {
            background: #1e293b;
            color: #9ca3af;
        }
        .check-in-button {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }
        .check-in-button:active:not(:disabled) {
            transform: scale(0.98);
        }
        .check-in-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-slide-in {
            animation: slideIn 0.4s ease-out;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .success-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 24px 48px;
            border-radius: 16px;
            font-size: 24px;
            font-weight: bold;
            z-index: 1000;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            animation: fadeIn 0.3s;
        }
    </style>
</head>
<body class="light">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Icons
        const Settings = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        );

        const History = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
        );

        const ArrowLeft = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m15 18-6-6 6-6"/>
            </svg>
        );

        const Download = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const Upload = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const Moon = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        );

        const Sun = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
        );

        // Sound Effects
        const playSound = (type) => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'success') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'click') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.05);
            }
        };

        // Storage Manager
        class StorageManager {
            static KEYS = {
                STREAK: 'studyStreak_v3',
                LAST_CHECKIN: 'lastCheckIn_v3',
                GIFS: 'badgeGifs_v3',
                REVEALED: 'revealedBadges_v3',
                LOGS: 'checkInLogs_v3',
                LAST_AUTO_FAIL: 'lastAutoFail_v3',
                DARK_MODE: 'darkMode_v3',
                AUTO_BACKUP: 'autoBackup_v3',
                LAST_BACKUP_DATE: 'lastBackupDate_v3',
                BACKUP_SLOT_1: 'backupSlot1_v3',
                BACKUP_SLOT_2: 'backupSlot2_v3',
                BACKUP_SLOT_3: 'backupSlot3_v3'
            };

            static save(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (e) {
                    console.error('Storage error:', e);
                    return false;
                }
            }

            static load(key, defaultValue = null) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (e) {
                    console.error('Load error:', e);
                    return defaultValue;
                }
            }

            static addLog(type, message, streak) {
                const logs = this.load(this.KEYS.LOGS, []);
                logs.unshift({
                    timestamp: new Date().toISOString(),
                    type,
                    message,
                    streak,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString()
                });
                if (logs.length > 100) logs.pop();
                this.save(this.KEYS.LOGS, logs);
            }

            static exportData() {
                const data = {
                    streak: this.load(this.KEYS.STREAK, 0),
                    lastCheckIn: this.load(this.KEYS.LAST_CHECKIN),
                    gifs: this.load(this.KEYS.GIFS, {}),
                    revealed: this.load(this.KEYS.REVEALED, {}),
                    logs: this.load(this.KEYS.LOGS, []),
                    lastAutoFail: this.load(this.KEYS.LAST_AUTO_FAIL),
                    darkMode: this.load(this.KEYS.DARK_MODE, false),
                    exportDate: new Date().toISOString()
                };
                return JSON.stringify(data, null, 2);
            }

            static importData(jsonString) {
                try {
                    const data = JSON.parse(jsonString);
                    this.save(this.KEYS.STREAK, data.streak || 0);
                    this.save(this.KEYS.LAST_CHECKIN, data.lastCheckIn);
                    this.save(this.KEYS.GIFS, data.gifs || {});
                    this.save(this.KEYS.REVEALED, data.revealed || {});
                    this.save(this.KEYS.LOGS, data.logs || []);
                    this.save(this.KEYS.LAST_AUTO_FAIL, data.lastAutoFail);
                    this.save(this.KEYS.DARK_MODE, data.darkMode || false);
                    return true;
                } catch (e) {
                    console.error('Import error:', e);
                    return false;
                }
            }

            static validateData() {
                try {
                    const streak = this.load(this.KEYS.STREAK, 0);
                    const lastCheckIn = this.load(this.KEYS.LAST_CHECKIN);
                    
                    if (typeof streak !== 'number' || streak < 0) {
                        console.error('Data corruption detected: Invalid streak');
                        return false;
                    }
                    
                    if (lastCheckIn && isNaN(new Date(lastCheckIn).getTime())) {
                        console.error('Data corruption detected: Invalid date');
                        return false;
                    }
                    
                    return true;
                } catch (e) {
                    console.error('Data validation error:', e);
                    return false;
                }
            }

            static createAutoBackup() {
                const today = new Date().toDateString();
                const lastBackup = this.load(this.KEYS.LAST_BACKUP_DATE);
                
                if (lastBackup === today) return;
                
                const currentData = this.exportData();
                const backup2 = this.load(this.KEYS.BACKUP_SLOT_2);
                const backup1 = this.load(this.KEYS.BACKUP_SLOT_1);
                
                this.save(this.KEYS.BACKUP_SLOT_3, backup2);
                this.save(this.KEYS.BACKUP_SLOT_2, backup1);
                this.save(this.KEYS.BACKUP_SLOT_1, currentData);
                this.save(this.KEYS.LAST_BACKUP_DATE, today);
            }

            static getBackups() {
                const backups = [];
                for (let i = 1; i <= 3; i++) {
                    const key = this.KEYS[`BACKUP_SLOT_${i}`];
                    const backup = this.load(key);
                    if (backup) {
                        try {
                            const data = JSON.parse(backup);
                            backups.push({
                                slot: i,
                                date: data.exportDate || 'Unknown',
                                streak: data.streak || 0,
                                data: backup
                            });
                        } catch (e) {
                            console.error(`Backup slot ${i} corrupted`);
                        }
                    }
                }
                return backups;
            }

            static restoreBackup(slot) {
                const key = this.KEYS[`BACKUP_SLOT_${slot}`];
                const backup = this.load(key);
                if (backup) {
                    return this.importData(backup);
                }
                return false;
            }
        }

        const StudyStreakApp = () => {
          const [currentStreak, setCurrentStreak] = useState(0);
          const [lastCheckIn, setLastCheckIn] = useState(null);
          const [todayCheckedIn, setTodayCheckedIn] = useState(false);
          const [showSuccess, setShowSuccess] = useState(false);
          const [currentBadge, setCurrentBadge] = useState(null);
          const [showSettings, setShowSettings] = useState(false);
          const [showLogs, setShowLogs] = useState(false);
          const [badgeGifs, setBadgeGifs] = useState({});
          const [revealedBadges, setRevealedBadges] = useState({});
          const [logs, setLogs] = useState([]);
          const [timeUntilDeadline, setTimeUntilDeadline] = useState({ hours: 0, minutes: 0, seconds: 0 });
          const [canCheckIn, setCanCheckIn] = useState(false);
          const [darkMode, setDarkMode] = useState(false);
          const autoFailCheckRef = useRef(null);
          const fileInputRef = useRef(null);
          
          const defaultBadges = [
            { day: 0, name: 'BELIEVER' },
            { day: 1, name: 'KID' },
            { day: 2, name: 'COOL KID' },
            { day: 3, name: 'NEWBIE' },
            { day: 4, name: 'BEGINNER' },
            { day: 5, name: 'RECRUIT' },
            { day: 6, name: 'MEMBER' },
            { day: 7, name: 'WEAK 2 WEEK' },
            { day: 8, name: 'ELITE MEMBER' },
            { day: 9, name: 'SUPE' },
            { day: 10, name: 'CAPTAIN' },
            { day: 11, name: 'PERFECTIONIST' },
            { day: 12, name: 'SUPER SAIYAN' },
            { day: 13, name: 'INVINCIBLE' },
            { day: 14, name: 'URGE SMASHER' },
            { day: 15, name: 'BADASS' },
            { day: 16, name: 'WOLF', range: [16, 21] },
            { day: 22, name: 'BADASS MASTER', range: [22, 30] },
            { day: 31, name: 'CHAMP', range: [31, 45] },
            { day: 46, name: 'CONQUEROR', range: [46, 65] },
            { day: 66, name: 'LEGEND', range: [66, 90] },
            { day: 91, name: 'Sensei', range: [91, 120] },
            { day: 121, name: 'KING', range: [121, 150] },
            { day: 151, name: 'ELITE', range: [151, 200] },
            { day: 201, name: 'KRATOS', range: [201, 300] },
            { day: 300, name: 'ESCAPED MATRIX', range: [300, 999] }
          ];

          useEffect(() => {
            if (!StorageManager.validateData()) {
              if (confirm('‚ö†Ô∏è Data corruption detected! Restore from auto-backup?')) {
                const backups = StorageManager.getBackups();
                if (backups.length > 0) {
                  StorageManager.restoreBackup(1);
                  window.location.reload();
                  return;
                }
              }
            }

            StorageManager.createAutoBackup();

            const streak = StorageManager.load(StorageManager.KEYS.STREAK, 0);
            const lastCheckInData = StorageManager.load(StorageManager.KEYS.LAST_CHECKIN);
            const gifs = StorageManager.load(StorageManager.KEYS.GIFS, {});
            const revealed = StorageManager.load(StorageManager.KEYS.REVEALED, {});
            const savedLogs = StorageManager.load(StorageManager.KEYS.LOGS, []);
            const savedDarkMode = StorageManager.load(StorageManager.KEYS.DARK_MODE, false);
            
            setCurrentStreak(streak);
            setBadgeGifs(gifs);
            setRevealedBadges(revealed);
            setLogs(savedLogs);
            setDarkMode(savedDarkMode);
            document.body.className = savedDarkMode ? 'dark' : 'light';
            
            if (lastCheckInData) {
              const lastDate = new Date(lastCheckInData);
              const today = new Date();
              
              if (lastDate.toDateString() === today.toDateString()) {
                setTodayCheckedIn(true);
                setLastCheckIn(lastDate);
              }
            }
          }, []);

          useEffect(() => {
            const checkAutoFail = () => {
              const now = new Date();
              const hours = now.getHours();
              const minutes = now.getMinutes();
              const today = now.toDateString();
              const lastAutoFail = StorageManager.load(StorageManager.KEYS.LAST_AUTO_FAIL);
              
              if (hours === 23 && minutes === 55 && !todayCheckedIn && lastAutoFail !== today) {
                StorageManager.save(StorageManager.KEYS.STREAK, 0);
                StorageManager.save(StorageManager.KEYS.LAST_AUTO_FAIL, today);
                StorageManager.addLog('auto_fail', 'Auto-failed: Missed deadline', 0);
                setCurrentStreak(0);
              }
            };
            
            autoFailCheckRef.current = setInterval(checkAutoFail, 60000);
            checkAutoFail();
            
            return () => {
              if (autoFailCheckRef.current) clearInterval(autoFailCheckRef.current);
            };
          }, [todayCheckedIn]);

          useEffect(() => {
            const updateCountdown = () => {
              const now = new Date();
              const hours = now.getHours();
              const minutes = now.getMinutes();
              
              const canCheck = (hours >= 15 && hours < 23) || (hours === 23 && minutes <= 55);
              setCanCheckIn(canCheck);
              
              const deadline = new Date();
              deadline.setHours(23, 55, 0, 0);
              
              if (now > deadline) deadline.setDate(deadline.getDate() + 1);
              
              const diff = deadline - now;
              const h = Math.floor(diff / (1000 * 60 * 60));
              const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
              const s = Math.floor((diff % (1000 * 60)) / 1000);
              
              setTimeUntilDeadline({ hours: h, minutes: m, seconds: s });
            };
            
            updateCountdown();
            const interval = setInterval(updateCountdown, 1000);
            return () => clearInterval(interval);
          }, []);

          useEffect(() => {
            const badge = getCurrentBadge();
            setCurrentBadge(badge);
          }, [currentStreak]);

          const getCurrentBadge = () => {
            for (let i = defaultBadges.length - 1; i >= 0; i--) {
              const badge = defaultBadges[i];
              if (badge.range) {
                if (currentStreak >= badge.range[0] && currentStreak <= badge.range[1]) return badge;
              } else if (currentStreak >= badge.day) return badge;
            }
            return defaultBadges[0];
          };

          const getNextTarget = () => {
            const futureBadges = defaultBadges.filter(badge => {
              const badgeDay = badge.range ? badge.range[0] : badge.day;
              return badgeDay > currentStreak;
            });
            
            if (futureBadges.length >= 2) {
              const secondNext = futureBadges[1];
              return secondNext.range ? secondNext.range[0] : secondNext.day;
            } 
            else if (futureBadges.length === 1) {
              const next = futureBadges[0];
              return next.range ? next.range[0] : next.day;
            }
            
            return currentStreak + 2;
          };

          const getProgress = () => {
            const nextTarget = getNextTarget();
            if (nextTarget <= currentStreak) return 100;
            
            let prevMilestone = 0;
            for (let i = 0; i < defaultBadges.length; i++) {
              const badge = defaultBadges[i];
              const badgeDay = badge.range ? badge.range[0] : badge.day;
              
              if (badgeDay < currentStreak) {
                prevMilestone = badgeDay;
              } else if (badgeDay >= currentStreak) {
                break;
              }
            }
            
            const totalDistance = nextTarget - prevMilestone;
            const currentProgress = currentStreak - prevMilestone;
            const progress = (currentProgress / totalDistance) * 100;
            
            return Math.min(100, Math.max(0, progress));
          };

          const handleCheckInToggle = () => {
            if (todayCheckedIn) {
              if (confirm('‚ö†Ô∏è UNDO CHECK-IN?\n\nThis will decrease your streak by 1 day.\nAre you sure?')) {
                playSound('click');
                const newStreak = Math.max(0, currentStreak - 1);
                setCurrentStreak(newStreak);
                setTodayCheckedIn(false);
                setLastCheckIn(null);
                
                StorageManager.save(StorageManager.KEYS.STREAK, newStreak);
                StorageManager.save(StorageManager.KEYS.LAST_CHECKIN, null);
                StorageManager.addLog('undo', 'Check-in undone', newStreak);
                setLogs(StorageManager.load(StorageManager.KEYS.LOGS, []));
              }
            } else {
              const now = new Date();
              const hours = now.getHours();
              const minutes = now.getMinutes();
              
              if (hours < 15 || hours > 23 || (hours === 23 && minutes > 55)) {
                alert("Check-in: 3:00 PM - 11:55 PM only!");
                return;
              }

              playSound('success');
              const newStreak = currentStreak + 1;
              setCurrentStreak(newStreak);
              setTodayCheckedIn(true);
              setLastCheckIn(now);
              setShowSuccess(true);
              
              StorageManager.save(StorageManager.KEYS.STREAK, newStreak);
              StorageManager.save(StorageManager.KEYS.LAST_CHECKIN, now.toISOString());
              StorageManager.addLog('success', `‚úì Check-in at ${now.toLocaleTimeString()}`, newStreak);
              setLogs(StorageManager.load(StorageManager.KEYS.LOGS, []));
              
              setTimeout(() => setShowSuccess(false), 3000);
            }
          };

          const handleGifUpdate = (day, gifUrl) => {
            const newGifs = { ...badgeGifs, [day]: gifUrl };
            setBadgeGifs(newGifs);
            StorageManager.save(StorageManager.KEYS.GIFS, newGifs);
          };

          const toggleReveal = (day) => {
            playSound('click');
            const newRevealed = { ...revealedBadges, [day]: !revealedBadges[day] };
            setRevealedBadges(newRevealed);
            StorageManager.save(StorageManager.KEYS.REVEALED, newRevealed);
          };

          const toggleDarkMode = () => {
            playSound('click');
            const newMode = !darkMode;
            setDarkMode(newMode);
            document.body.className = newMode ? 'dark' : 'light';
            StorageManager.save(StorageManager.KEYS.DARK_MODE, newMode);
          };
          
          const handleExport = () => {
            playSound('click');
            const data = StorageManager.exportData();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const filename = `study-streak-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert(`‚úÖ Data exported!\n\nFile: ${filename}\n\nCheck your Downloads folder!`);
          };

          const handleImport = (event) => {
            const file = event.target.files[0];
            if (file) {
              if (!confirm('‚ö†Ô∏è IMPORT DATA?\n\nThis will REPLACE all current data.\nA backup will be created automatically.\n\nContinue?')) {
                event.target.value = '';
                return;
              }

              StorageManager.createAutoBackup();

              const reader = new FileReader();
              reader.onload = (e) => {
                const success = StorageManager.importData(e.target.result);
                if (success) {
                  playSound('success');
                  alert('‚úÖ Data imported successfully! Refreshing...');
                  window.location.reload();
                } else {
                  alert('‚ùå Import failed. Please check the file format.');
                }
              };
              reader.readAsText(file);
            }
          };
          
          const isBadgeCurrent = (badge) => {
            if (badge.range) return currentStreak >= badge.range[0] && currentStreak <= badge.range[1];
            return currentStreak === badge.day;
          };

          const isBadgeUnlocked = (badge) => {
            if (badge.range) return currentStreak >= badge.range[0];
            return currentStreak >= badge.day;
          };

          if (showSettings) {
            return (
              <div className="animate-slide-in" style={{minHeight: '100vh', padding: '16px'}}>
                <div style={{maxWidth: '600px', margin: '0 auto'}}>
                  <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px'}}>
                    <button onClick={() => { playSound('click'); setShowSettings(false); }} style={{background: darkMode ? '#1e293b' : 'white', color: darkMode ? 'white' : 'black', borderRadius: '8px', padding: '8px', border: 'none', cursor: 'pointer'}}>
                      <ArrowLeft />
                    </button>
                    <h2 style={{fontSize: '20px', fontWeight: 'bold', color: darkMode ? 'white' : '#111'}}>Settings</h2>
                  </div>
                  
                  <div style={{background: darkMode ? '#1e293b' : 'white', borderRadius: '16px', padding: '16px', marginBottom: '16px'}}>
                    <h3 style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '16px', color: darkMode ? 'white' : 'black'}}>Preferences</h3>
                    
                    <button onClick={toggleDarkMode} style={{width: '100%', padding: '12px', background: darkMode ? '#0f172a' : '#f3f4f6', border: 'none', borderRadius: '8px', cursor: 'pointer', marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', color: darkMode ? 'white' : 'black'}}>
                      <span style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                        {darkMode ? <Moon /> : <Sun />}
                        <span>{darkMode ? 'Dark Mode' : 'Light Mode'}</span>
                      </span>
                      <span style={{padding: '4px 12px', background: darkMode ? '#10b981' : '#3b82f6', borderRadius: '12px', fontSize: '12px', color: 'white'}}>ON</span>
                    </button>
                    
                    <button onClick={handleExport} style={{width: '100%', padding: '12px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', fontWeight: 'bold'}}>
                      <Download />
                      Export Backup
                    </button>

                    <input ref={fileInputRef} type="file" accept=".json" onChange={handleImport} style={{display: 'none'}} />
                    <button onClick={() => { playSound('click'); fileInputRef.current.click(); }} style={{width: '100%', padding: '12px', background: '#3b82f6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', fontWeight: 'bold'}}>
                      <Upload />
                      Import Backup
                    </button>

                    <div style={{marginTop: '16px', padding: '12px', background: darkMode ? '#0f172a' : '#fef3c7', borderRadius: '8px', border: '2px solid #f59e0b'}}>
                      <h4 style={{fontSize: '14px', fontWeight: 'bold', marginBottom: '8px', color: darkMode ? '#fbbf24' : '#92400e'}}>üîÑ Auto-Backup Recovery</h4>
                      <p style={{fontSize: '12px', marginBottom: '12px', color: darkMode ? '#fcd34d' : '#78350f'}}>Last 3 automatic backups (daily)</p>
                      {StorageManager.getBackups().map((backup) => (
                        <button 
                          key={backup.slot}
                          onClick={() => {
                            if (confirm(`Restore backup from ${new Date(backup.date).toLocaleDateString()}?\n\nStreak: ${backup.streak} days\n\nCurrent data will be lost!`)) {
                              StorageManager.restoreBackup(backup.slot);
                              playSound('success');
                              alert('‚úÖ Backup restored! Refreshing...');
                              window.location.reload();
                            }
                          }}
                          style={{
                            width: '100%',
                            padding: '10px',
                            background: darkMode ? '#1e293b' : 'white',
                            border: '1px solid #d1d5db',
                            borderRadius: '6px',
                            cursor: 'pointer',
                            marginBottom: '8px',
                            textAlign: 'left',
                            color: darkMode ? 'white' : 'black'
                          }}
                        >
                          <div style={{fontSize: '12px', fontWeight: 'bold'}}>Backup #{backup.slot}</div>
                          <div style={{fontSize: '11px', color: '#6b7280'}}>
                            {new Date(backup.date).toLocaleDateString()} ¬∑ Streak: {backup.streak} days
                          </div>
                        </button>
                      ))}
                      {StorageManager.getBackups().length === 0 && (
                        <p style={{fontSize: '12px', color: '#6b7280', textAlign: 'center', padding: '8px'}}>No auto-backups yet</p>
                      )}
                    </div>
                  </div>

                  <div style={{background: darkMode ? '#1e293b' : 'white', borderRadius: '16px', padding: '16px', marginBottom: '16px'}}>
                    <h3 style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '12px', color: darkMode ? 'white' : 'black'}}>Add Badge GIFs</h3>
                    <p style={{fontSize: '13px', color: '#6b7280', marginBottom: '16px'}}>Paste direct GIF URLs (from Giphy, Tenor, etc.)</p>
                    
                    <div style={{maxHeight: '50vh', overflowY: 'auto'}}>
                      {defaultBadges.map((badge) => (
                        <div key={badge.day} style={{marginBottom: '12px', padding: '12px', background: darkMode ? '#0f172a' : '#f9fafb', borderRadius: '8px'}}>
                          <div style={{fontSize: '13px', fontWeight: 'bold', marginBottom: '6px', color: darkMode ? 'white' : 'black'}}>
                            Day {badge.day}: {badge.name}
                          </div>
                          <input
                            type="text"
                            placeholder="Paste GIF URL here"
                            value={badgeGifs[badge.day] || ''}
                            onChange={(e) => handleGifUpdate(badge.day, e.target.value)}
                            style={{width: '100%', padding: '8px', fontSize: '12px', border: '1px solid #d1d5db', borderRadius: '6px', background: darkMode ? '#1e293b' : 'white', color: darkMode ? 'white' : 'black'}}
                          />
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (showLogs) {
            return (
              <div className="animate-slide-in" style={{minHeight: '100vh', padding: '16px'}}>
                <div style={{maxWidth: '600px', margin: '0 auto'}}>
                  <div style={{display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px'}}>
                    <button onClick={() => { playSound('click'); setShowLogs(false); }} style={{background: darkMode ? '#1e293b' : 'white', color: darkMode ? 'white' : 'black', borderRadius: '8px', padding: '8px', border: 'none', cursor: 'pointer'}}>
                      <ArrowLeft />
                    </button>
                    <h2 style={{fontSize: '20px', fontWeight: 'bold', color: darkMode ? 'white' : '#111'}}>History</h2>
                  </div>
                  
                  <div style={{maxHeight: '70vh', overflowY: 'auto'}}>
                    {logs.length === 0 ? (
                      <p style={{textAlign: 'center', color: '#6b7280', padding: '32px'}}>No logs yet</p>
                    ) : (
                      logs.map((log, index) => (
                        <div key={index} className="animate-fade-in" style={{
                          background: log.type === 'success' ? '#d1fae5' : log.type === 'auto_fail' ? '#fee2e2' : '#fed7aa',
                          padding: '12px 16px',
                          borderRadius: '12px',
                          marginBottom: '8px',
                          borderLeft: `4px solid ${log.type === 'success' ? '#10b981' : log.type === 'auto_fail' ? '#ef4444' : '#f59e0b'}`
                        }}>
                          <div style={{fontSize: '14px', fontWeight: '600', marginBottom: '4px'}}>{log.message}</div>
                          <div style={{fontSize: '12px', color: '#6b7280'}}>
                            {log.date} at {log.time} ¬∑ Streak: {log.streak} days
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="animate-fade-in" style={{minHeight: '100vh', padding: '16px'}}>
              <div style={{maxWidth: '600px', margin: '0 auto'}}>
                {showSuccess && (
                  <>
                    <div className="modal-overlay"></div>
                    <div className="success-popup">
                      üéâ Check-in Success!
                    </div>
                  </>
                )}

                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                  <div className="compact-timer">
                    ‚è∞ {String(timeUntilDeadline.hours).padStart(2, '0')}:{String(timeUntilDeadline.minutes).padStart(2, '0')}:{String(timeUntilDeadline.seconds).padStart(2, '0')} until deadline
                  </div>
                  <div style={{display: 'flex', gap: '8px'}}>
                    <button onClick={() => { playSound('click'); setShowLogs(true); }} style={{background: '#3b82f6', color: 'white', borderRadius: '8px', padding: '8px', border: 'none', cursor: 'pointer', transition: 'all 0.2s'}}>
                      <History />
                    </button>
                    <button onClick={() => { playSound('click'); setShowSettings(true); }} style={{background: '#6b7280', color: 'white', borderRadius: '8px', padding: '8px', border: 'none', cursor: 'pointer', transition: 'all 0.2s'}}>
                      <Settings />
                    </button>
                  </div>
                </div>

                {currentBadge && (
                  <div style={{marginBottom: '24px'}} className="animate-slide-in">
                    <div style={{textAlign: 'center', marginBottom: '8px'}}>
                      <div style={{fontSize: '11px', color: '#9ca3af', letterSpacing: '2px', fontWeight: '600'}}>B A D G E</div>
                      <div style={{fontSize: '28px', fontWeight: 'bold', color: darkMode ? '#d1d5db' : '#6b7280', marginTop: '4px'}}>{currentBadge.name}</div>
                      <div style={{fontSize: '14px', color: '#9ca3af', marginTop: '2px'}}>DAY {currentStreak}</div>
                    </div>
                    
                    {badgeGifs[currentBadge.day] && revealedBadges[currentBadge.day] ? (
                      <div className="gif-badge-container" onClick={() => toggleReveal(currentBadge.day)}>
                        <img src={badgeGifs[currentBadge.day]} alt={currentBadge.name} />
                      </div>
                    ) : badgeGifs[currentBadge.day] ? (
                      <div className="gif-badge-container tap-to-play" onClick={() => toggleReveal(currentBadge.day)}>
                        Tap to Play
                      </div>
                    ) : (
                      <div className="gif-badge-container tap-to-play">
                        No GIF
                      </div>
                    )}
                  </div>
                )}

                <div style={{background: '#1f2937', borderRadius: '16px', padding: '20px', marginBottom: '16px', color: 'white'}}>
                  <div style={{fontSize: '16px', marginBottom: '8px'}}>CURRENT DAYS: {currentStreak}</div>
                  <div style={{fontSize: '13px', color: '#9ca3af', marginBottom: '12px'}}>YOUR NEXT TARGET ‚Üí {getNextTarget()} DAYS</div>
                  <div className="progress-bar-visual">
                    <div className="progress-fill" style={{width: `${getProgress()}%`}}></div>
                  </div>
                  <div style={{fontSize: '13px', color: '#9ca3af', marginTop: '8px', textAlign: 'center'}}>{getProgress().toFixed(1)}% COMPLETED</div>
                </div>

                <button
                  onClick={handleCheckInToggle}
                  disabled={!todayCheckedIn && !canCheckIn}
                  className="check-in-button"
                  style={{
                    background: todayCheckedIn 
                      ? '#9ca3af' 
                      : canCheckIn 
                      ? 'linear-gradient(135deg, #ef4444, #dc2626)' 
                      : '#d1d5db',
                    color: 'white',
                    marginBottom: '24px',
                    opacity: (!todayCheckedIn && !canCheckIn) ? 0.6 : 1
                  }}
                >
                  {todayCheckedIn ? '‚úì Checked In Today (Tap to Undo)' : canCheckIn ? 'Tap to Check In' : 'üîí Opens at 3:00 PM'}
                </button>

                <div style={{marginBottom: '16px'}}>
                  <div style={{textAlign: 'center', fontSize: '12px', color: '#9ca3af', letterSpacing: '2px', marginBottom: '16px'}}>A L L   B A D G E S</div>
                  <div style={{textAlign: 'center', color: '#ef4444', fontSize: '24px', marginBottom: '16px'}}>‚Üì</div>
                  
                  {defaultBadges.map((badge) => {
                    const isCurrent = isBadgeCurrent(badge);
                    const isUnlocked = isBadgeUnlocked(badge);
                    const hasGif = badgeGifs[badge.day];
                    const isRevealed = revealedBadges[badge.day];
                    
                    return (
                      <div key={badge.day} className={`badge-item ${isCurrent ? 'current' : isUnlocked ? 'unlocked' : 'locked'}`}>
                        <div>
                          <div style={{fontSize: '11px', opacity: 0.7, marginBottom: '2px', color: darkMode && !isCurrent ? '#9ca3af' : 'inherit'}}>DAY {badge.day}</div>
                          <div style={{fontSize: '15px', fontWeight: 'bold', color: darkMode && !isCurrent ? 'white' : 'inherit'}}>{badge.name} {isUnlocked && '‚úÖ'}</div>
                        </div>
                        
                        {hasGif && isUnlocked ? (
                          isRevealed ? (
                            <div className="small-gif" onClick={() => toggleReveal(badge.day)}>
                              <img src={badgeGifs[badge.day]} alt={badge.name} />
                            </div>
                          ) : (
                            <div className="small-gif tap-to-play" onClick={() => toggleReveal(badge.day)} style={{fontSize: '12px', padding: '8px'}}>
                              Tap to Play
                            </div>
                          )
                        ) : (
                          <div style={{width: '160px', height: '100px', background: darkMode ? '#0f172a' : '#e5e7eb', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', color: '#9ca3af'}}>
                            {isUnlocked ? 'No GIF' : 'üîí'}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StudyStreakApp />);
    </script>
</body>
</html>
